From 72fad08f2bfe7d2744c3217fe0ec0afcc671c53e Mon Sep 17 00:00:00 2001
From: Carlos Garcia Campos <carlosgc@webkit.org>
Date: Fri, 1 Apr 2022 09:00:32 +0000
Subject: [PATCH] REGRESSION(r290360): [GLX] Crash on process exit https://bugs.webkit.org/show_bug.cgi?id=238494

Index: Source/WebCore/platform/graphics/x11/PlatformDisplayX11.h
--- Source/WebCore/platform/graphics/x11/PlatformDisplayX11.h.orig
+++ Source/WebCore/platform/graphics/x11/PlatformDisplayX11.h
@@ -41,7 +41,9 @@ namespace WebCore {
 class PlatformDisplayX11 final : public PlatformDisplay {
 public:
     static std::unique_ptr<PlatformDisplay> create();
-    static std::unique_ptr<PlatformDisplay> create(::Display*);
+#if PLATFORM(GTK)
+    static std::unique_ptr<PlatformDisplay> create(GdkDisplay*);
+#endif
 
     virtual ~PlatformDisplayX11();
 
@@ -52,7 +54,12 @@ class PlatformDisplayX11 final : public PlatformDispla
     bool supportsGLX(std::optional<int>& glxErrorBase) const;
 
 private:
-    PlatformDisplayX11(::Display*, NativeDisplayOwned);
+    explicit PlatformDisplayX11(::Display*);
+#if PLATFORM(GTK)
+    explicit PlatformDisplayX11(GdkDisplay*);
+
+    void sharedDisplayDidClose() override;
+#endif
 
     Type type() const override { return PlatformDisplay::Type::X11; }
 
